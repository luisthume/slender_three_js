<!DOCTYPE html>
<html>
    <head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=no">
        <title>Three.js Crash Course</title>

		<link rel="stylesheet" href="touch/css/touch-pad.css">
		<link rel="stylesheet" href="touch/css/main.css">
        <style>
        	body { margin: 0; position: relative;}
        	canvas { width: 100%; height:100%;};
		</style>

    </head>

    <body>
		<div style="position: relative;" id="container">
			<div style="position: relative;" id="container3d"></div>
		</div>
		
    	<script src="js/three.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/OBJLoader.js"></script>
		<script type="text/javascript" src="touch/js/movement-pad.js"></script>
		<script type="text/javascript" src="touch/js/rotation-pad.js"></script>
		<script type="text/javascript" src="touch/js/touch-controls.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>

    	<script>
		var width, height;
		var viewAngle = 45,
			near = 0.1,
			far = 1000;
		var aspect;

		var renderer, camera, scene, controls;
		var sceneObject, intersected;

		var elem = document.documentElement;

		function openFullscreen() {
			if (elem.requestFullscreen) {
				elem.requestFullscreen();
			} else if (elem.webkitRequestFullscreen) { /* Safari */
				elem.webkitRequestFullscreen();
			} else if (elem.msRequestFullscreen) { /* IE11 */
				elem.msRequestFullscreen();
			}
		}
		
		$(function() {			
			var container = $("#container3d");
			startScene(container);
		});

		function startScene(container) {

			width = window.innerWidth;
			height = window.innerHeight;
			aspect = width / height;

			scene = new THREE.Scene();

			const mattressLoader = new THREE.OBJLoader();
			let mattress;
			// load a resource
			mattressLoader.load(
				// resource URL
				'models/sink/Sink_UV.obj',
				// called when resource is loaded
				function ( mattress ) {
					mattress.position.x = 0;
					mattress.position.y = -10;
					mattress.position.z = -10;		
					mattress.rotateY(Math.PI)	

					mattress.scale.x = 0.5;
					mattress.scale.y = 0.5;
					mattress.scale.z = 0.5;

					mattress.traverse( function ( child ) {

					if ( child instanceof THREE.Mesh ) {
						const mattressTexture = new THREE.TextureLoader().load( 'models/sink/Sink_Base_Color.png' );	
						mattressTexture.wrapS = THREE.RepeatWrapping;
						mattressTexture.wrapT = THREE.RepeatWrapping;
						mattressTexture.repeat.set( 1, 1 );
						
						child.material = new THREE.MeshBasicMaterial( {map: mattressTexture} )
						}
					} );
					scene.add( mattress )

					addControls();	
					
					animate();

				}
			);

			function addControls() {
				// Camera
				camera = new THREE.PerspectiveCamera(viewAngle, aspect, near, far);
				// Controls
				var options = {
					speedFactor: 0.1,
					delta: 1,
					rotationFactor: 0.003,
					maxPitch: 55,
					hitTest: false
				};
				controls = new TouchControls(container.parent(), camera, options);
				controls.addToScene(scene);
			}

			renderer = new THREE.WebGLRenderer();
			renderer.setSize(width, height);
			container.append(renderer.domElement);

			$(window).on("resize", onWindowResize);
		}

		function animate() {

			requestAnimationFrame(animate);

			controls.update();

			var vector = new THREE.Vector3(controls.mouse.x, controls.mouse.y, 1);
			vector.unproject(camera);

			var raycaster = new THREE.Raycaster( controls.fpsBody.position, vector.sub(controls.fpsBody.position).normalize() );

			renderer.render(scene, camera);
		}

		function onWindowResize() {

			width = window.innerWidth;
			height = window.innerHeight;

			camera.aspect = width / height;
			camera.updateProjectionMatrix();

			renderer.setSize(width, height);
		}

    	</script>

    </body>
</html>