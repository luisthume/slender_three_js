<!DOCTYPE html>
<html>
    <head>
        <title>Three.js Crash Course</title>

		<link rel="stylesheet" href="touch/css/touch-pad.css">
		<link rel="stylesheet" href="touch/css/main.css">
    </head>

    <body>
		<div id="container">
			<h3>Touch Controls Test: </h3>
			<div id="container3d"></div>
		</div>			
		
    	<script src="js/three.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/OBJLoader.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>

		<script type="text/javascript" src="touch/js/movement-pad.js"></script>
		<script type="text/javascript" src="touch/js/rotation-pad.js"></script>
		<script type="text/javascript" src="touch/js/touch-controls.js"></script>

    	<script>
    		//(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='//mrdoob.github.io/stats.js/build/stats.min.js';document.head.appendChild(script);})()
    		var scene = new THREE.Scene();
    		var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

    		var renderer = new THREE.WebGLRenderer( );
    		renderer.setSize( window.innerWidth, window.innerHeight );
    		document.body.appendChild( renderer.domElement );

    		window.addEventListener('resize', function()
    		{
    			var width = window.innerWidth;
    			var height = window.innerHeight;
    			renderer.setSize( width, height);
    			camera.aspect = width / height;
    			camera.updateProjectionMatrix();
			});
			
			var container = $("#container3d");
			console.log(container)

			// Controls
			var options = {
				speedFactor: 0.5,
				delta: 1,
				rotationFactor: 0.002,
				maxPitch: 55
			};
			controls = new TouchControls(container.parent(), camera, options);
			controls.addToScene(scene);
			// controls.setRotation(0.15, -0.15);

			container.append(renderer.domElement);


    		const axesHelper = new THREE.AxesHelper( 5 );
			scene.add( axesHelper );

			const mattressLoader = new THREE.OBJLoader();
							let mattress;
							// load a resource
							mattressLoader.load(
								// resource URL
								'models/mattress/mattress.obj',
								// called when resource is loaded
								function ( mattress ) {
									mattress.position.x = 0;
									mattress.position.y = 5;
									mattress.position.z = 0;		
									mattress.rotateY(Math.PI)	

									mattress.scale.x = 0.05;
									mattress.scale.y = 0.05;
									mattress.scale.z = 0.05;


									mattress.traverse( function ( child ) {

									if ( child instanceof THREE.Mesh ) {
										const mattressTexture = new THREE.TextureLoader().load( 'models/mattress/mattressTexture.jpg' );			
										child.material = new THREE.MeshBasicMaterial( {map: mattressTexture, side: THREE.DoubleSide} )
										}
									} );
									scene.add( mattress )
								}
							);

    		camera.position.z = 10

    		var ambientLight = new THREE.AmbientLight(0xffffff, 1.0);
    		scene.add(ambientLight);

    		// game logic
    		var update = function ( )
    		{

    			var time = Date.now() * 0.0005;

    		};

    		// draw scene
    		var render = function( )
    		{

				controls.update();
    			renderer.render( scene, camera);    			
    		};

    		//run game loop (update, render, repeat)
    		var GameLoop = function( )
    		{
    			requestAnimationFrame( GameLoop );

    			update( );
    			render( );
    		};

    		GameLoop( );
    	</script>

    </body>
</html>